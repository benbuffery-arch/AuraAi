const CONFIG={FORM_ENDPOINT:"",STRIPE_URL:"./success.html?mock=stripe"};const qs=(s,e=document)=>e.querySelector(s),qsa=(s,e=document)=>Array.from(e.querySelectorAll(s)),fmtMoney=e=>e.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}),getParam=e=>new URLSearchParams(location.search).get(e)||"";function computeEstimate(e){const t=e.sector||"other",n=+e.rev||0,o=Math.min(95,Math.max(1,+e.gm||40)),a=Math.max(1,Math.round(+e.staff||1)),r=Math.max(1,+e.rate||25),s=Math.min(100,Math.max(1,+e.util||60)),l=Math.max(0,Math.round(+e.tools||0)),c=Math.max(0,+e.seat||25),i=Math.max(0,+e.ads||0),d=Math.max(.1,+e.roas||1.5),u=!!e.noshow,g={trades:{util:75,vendorDrift:.008},spa:{util:70,vendorDrift:.006},clinic:{util:72,vendorDrift:.006},contractor:{util:73,vendorDrift:.01},other:{util:70,vendorDrift:.006}}[t]||g;var v;s/=100;const m=g.util/100,p=Math.max(0,m-s),f=a*160*r,h=f*p*.35,y=f*p*.65,b=Math.max(0,l-5),x=l*c,k=Math.min(.15,.02*b)*x,q=Math.min(.3,.04*b)*x,C=o/100,w=n*(1-C),E=g.vendorDrift*w,S=2.2*g.vendorDrift*w;let L=[0,0];if(u){const e="spa"===t||"clinic"===t?.03:.01,o="spa"===t||"clinic"===t?.07:.03,a=n*e*C,r=n*o*C;L=[12*a,12*r]}let D=[0,0];i>0&&((v=d<2?{low:.05,high:.15}:{low:.02,high:.06}),D=[12*i*v.low,12*i*v.high]);const M=Math.round(12*h+12*k+12*E+L[0]+D[0]),T=Math.round(12*y+12*q+12*S+L[1]+D[1]);return{low:M,high:T,parts:[{label:"Labour efficiency",low:Math.round(12*h),high:Math.round(12*y)},{label:"SaaS waste",low:Math.round(12*k),high:Math.round(12*q)},{label:"Vendor drift",low:Math.round(12*E),high:Math.round(12*S)},{label:"No-show recovery",low:Math.round(L[0]),high:Math.round(L[1])},{label:"Ad spend trim",low:Math.round(D[0]),high:Math.round(D[1])}].filter((e=>e.low>0||e.high>0))}}function initFreeScan(){const e=qs("#step1"),t=qs("#step2"),n=qs("#teaser");if(!e||!t||!n)return;qs("#toStep2")?.addEventListener("click",(t=>{t.preventDefault();const n=qs("input[name='name']").value.trim(),o=qs("input[name='email']").value.trim();n&&o?(e.style.display="none",t=>(t.style.display="block",window.scrollTo({top:t.offsetTop-20,behavior:"smooth"})))(qs("#step2")):alert("Please enter your name and work email.")})),qs("#calc")?.addEventListener("click",(e=>{e.preventDefault();const n={sector:qs("#sector")?.value||"other",rev:qs("#rev")?.value,gm:qs("#gm")?.value,staff:qs("#staff2")?.value,rate:qs("#rate")?.value,util:qs("#util")?.value,tools:qs("#tools")?.value,seat:qs("#seat")?.value,ads:qs("#ads")?.value,roas:qs("#roas")?.value,noshow:qs("#noshow")?.checked},o=computeEstimate(n),a=o.low,r=o.high;qs("#estRange").textContent=`${fmtMoney(a)} – ${fmtMoney(r)} / yr`,qs("#u_labour").textContent="Productive hours are slipping between jobs and admin. We show exactly where to plug the leak.",qs("#u_saas").textContent="You’re paying for duplicate tools. We list them by cost, renewal date, and what to cancel first.",qs("#u_vendor").textContent="Suppliers are quietly raising prices. We flag each one and give you the refund email template.",t.style.display="none",n=>(n.style.display="block",window.scrollTo({top:n.offsetTop-20,behavior:"smooth"}))(qs("#teaser"))})),qsa(".unlock").forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),location.href=CONFIG.STRIPE_URL})))),qs("#calc")?.addEventListener("click",(async()=>{if(!CONFIG.FORM_ENDPOINT)return;try{const e=new FormData(qs("#scanForm"));await fetch(CONFIG.FORM_ENDPOINT,{method:"POST",body:e,headers:{Accept:"application/json"}})}catch(e){}}))}function initCountdown(){const e=qs("#countdown");if(!e)return;let t=9*60+59;const n=()=>{const n=String(Math.floor(t/60)).padStart(2,"0"),o=String(t%60).padStart(2,"0");e.textContent=`${n}:${o}`,t=Math.max(0,t-1)};n(),setInterval(n,1e3)}function initDashboard(){const e=qs("#dashboard");if(!e)return;const t=getParam("token")||"demo",n={name:"Ben",progress:.78,confirmedSavings:9440,cards:[{name:"SaaS overlap",status:"confirmed",savings:2480},{name:"Labour efficiency",status:"processing"},{name:"Vendor drift",status:"pending"}],nextStep:"Upload last 3 months supplier invoices (CSV/PDF)",pdf:""};qs("#hello").textContent=`Welcome ${n.name}, your audit is ${Math.round(100*n.progress)}% complete.`,qs("#confirmed").textContent=fmtMoney(n.confirmedSavings)+" / yr confirmed",qs("#nextStep").textContent=n.nextStep}document.addEventListener("DOMContentLoaded",(()=>{initFreeScan(),initCountdown(),initDashboard()}));